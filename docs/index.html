
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SecuriTrento API Documentation</title>
  <link rel="stylesheet" type="text/css" href="./swagger-ui.css">
  <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16">
  <style>
    html { box-sizing: border-box; overflow: -moz-scrollbars-vertical; overflow-y: scroll; }
    *, *:before, *:after { box-sizing: inherit; }
    body { margin: 0; background: #fafafa; }
    .swagger-ui .topbar { display: none; }
  </style>
</head>
<body>
  <div id="swagger-ui"></div>

  <script src="./swagger-ui-bundle.js"></script>
  <script src="./swagger-ui-standalone-preset.js"></script>
  <script>
    window.onload = function() {
      // Begin Swagger UI call region
      const ui = SwaggerUIBundle({
        // Use embedded spec instead of URL - this is key for offline use
        spec: {"openapi":"3.0.0","info":{"title":"SecuriTrento API Documentation","version":"1.0.0","description":"API documentation for the SecuriTrento application","license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"},"contact":{"name":"SecuriTrento Team","url":"https://github.com/JacCons/Ingegneria_del_software_gruppo_8"}},"servers":[{"url":"http://localhost:3000","description":"Development server"}],"paths":{"/api/login":{"post":{"summary":"Verifica le credenziali dell'utente e restituisce un token JWT.","tags":["Autenticazione"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"telefono":{"type":"number","example":"1489164451"},"password":{"type":"string","example":"password123"}}}}}},"responses":{"200":{"description":"Autenticazione avvenuta con successo, ritorna il token.","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"token":{"type":"string"}}}}}},"401":{"description":"Credenziali non valide.","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"message":{"type":"string"}}}}}}}}},"/api/notifiche/notifiche-segnalazioni/destinatario/{utenteDestinatarioId}":{"get":{"summary":"Recupera notifiche segnalazioni per un utente FDO","description":"Recupera tutte le notifiche di segnalazioni per un utente FDO specifico. \nPuò opzionalmente controllare e creare nuove notifiche per segnalazioni \nrecenti (max 8 ore) nel raggio specificato.\n","tags":["Notifiche"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"utenteDestinatarioId","required":true,"schema":{"type":"string","pattern":"^[0-9a-fA-F]{24}$","example":"64f1a2b3c4d5e6f7a8b9c0d1"},"description":"ID MongoDB dell'utente FDO destinatario delle notifiche"},{"in":"query","name":"autoCheck","required":false,"schema":{"type":"string","enum":["true","false"],"default":"false","example":"true"},"description":"Se true, controlla automaticamente segnalazioni recenti nel raggio \ne crea nuove notifiche se necessario. Se false, recupera solo \nnotifiche esistenti.\n"},{"in":"query","name":"raggio","required":false,"schema":{"type":"string","pattern":"^[0-9]+$","minimum":1,"maximum":50000,"default":"2500","example":"2500"},"description":"Raggio in metri per la ricerca di segnalazioni (solo se autoCheck=true).\nMinimo 1m, massimo 50km (50000m). Default 2.5km (2500m).\n"}],"responses":{"200":{"description":"Notifiche recuperate con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"type":"object","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d1"},"tipoNotifica":{"type":"string","example":"segnalazione"},"timestamp":{"type":"string","format":"date-time","example":"2025-05-29T10:30:00.000Z"},"destinatario":{"type":"object","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d1"},"nome":{"type":"string","example":"Mario"},"cognome":{"type":"string","example":"Rossi"}}},"idSegnalazione":{"type":"object","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d1"},"tipologia":{"type":"string","example":"Furto"},"descrizione":{"type":"string","example":"Furto di bicicletta in via Roma"},"coordinateGps":{"type":"object","properties":{"type":{"type":"string","example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.1219482,46.0664014]}}},"timeStamp":{"type":"string","format":"date-time","example":"2025-05-29T08:15:00.000Z"},"stato":{"type":"string","example":"aperto"}}}}}},"count":{"type":"integer","example":5,"description":"Numero totale di notifiche trovate"},"autoCheck":{"type":"boolean","example":true,"description":"Indica se è stato richiesto il controllo automatico"},"controlloEffettuato":{"type":"boolean","example":true,"description":"Indica se è stato effettuato il controllo automatico"},"nuoveNotificheCreate":{"type":"integer","example":2,"description":"Numero di nuove notifiche create con questo controllo"},"raggio":{"type":"integer","example":2500,"description":"Raggio utilizzato per la ricerca (in metri)"},"raggioKm":{"type":"string","example":"2.5","description":"Raggio utilizzato per la ricerca (in chilometri)"},"errorControllo":{"type":"string","nullable":true,"example":null,"description":"Eventuale errore durante il controllo automatico"},"destinatario":{"type":"object","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d1"},"nome":{"type":"string","example":"Mario"},"cognome":{"type":"string","example":"Rossi"},"tipoUtente":{"type":"string","example":"UtenteFDO"}}},"message":{"type":"string","example":"Trovate 5 notifiche (2 nuove create nel raggio di 2.5km)"}}},"examples":{"con_autocheck":{"summary":"Risposta con autoCheck=true","value":{"success":true,"data":[],"count":3,"autoCheck":true,"controlloEffettuato":true,"nuoveNotificheCreate":2,"raggio":2500,"raggioKm":"2.5","errorControllo":null,"destinatario":{"_id":"64f1a2b3c4d5e6f7a8b9c0d1","nome":"Mario","cognome":"Rossi","tipoUtente":"UtenteFDO"},"message":"Trovate 3 notifiche (2 nuove create nel raggio di 2.5km)"}},"senza_autocheck":{"summary":"Risposta con autoCheck=false (default)","value":{"success":true,"data":[],"count":3,"autoCheck":false,"controlloEffettuato":false,"nuoveNotificheCreate":0,"raggio":2500,"raggioKm":"2.5","errorControllo":null,"destinatario":{"_id":"64f1a2b3c4d5e6f7a8b9c0d1","nome":"Mario","cognome":"Rossi","tipoUtente":"UtenteFDO"},"message":"Trovate 3 notifiche per Mario Rossi"}}}}}},"400":{"description":"Errore nei parametri di input","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string"},"error":{"type":"string"}}},"examples":{"id_mancante":{"summary":"ID utente mancante","value":{"success":false,"message":"utenteDestinatarioId è richiesto"}},"id_invalido":{"summary":"ID utente non valido","value":{"success":false,"message":"utenteDestinatarioId non è un ID valido"}},"raggio_invalido":{"summary":"Raggio non valido","value":{"success":false,"message":"Il raggio deve essere un numero positivo e massimo 50km (50000 metri)","error":"INVALID_RADIUS"}},"utente_non_fdo":{"summary":"Utente non è FDO","value":{"success":false,"message":"L'utente con ID 64f1a2b3c4d5e6f7a8b9c0d1 non è un UtenteFDO","error":"USER_NOT_FDO"}}}}}},"401":{"$ref":"#/components/responses/UnauthorizedError"},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Utente con ID 64f1a2b3c4d5e6f7a8b9c0d1 non trovato"},"error":{"type":"string","example":"USER_NOT_FOUND"}}}}}},"500":{"description":"Errore interno del server","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Errore interno del server"},"error":{"type":"string","example":"Database connection failed"}}}}}}}}},"/api/notifiche/notifiche-conferma-richieste-allocazione":{"get":{"summary":"Recupera tutte le notifiche di conferma richieste allocazione","description":"Recupera tutte le notifiche di conferma per richieste di allocazione con i dati correlati:\n- Dettagli dell'utente FDO che ha accettato la richiesta\n- Dati completi della richiesta di allocazione\n","tags":["Notifiche"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Notifiche di conferma recuperate con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"type":"object","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d1","description":"ID della notifica di conferma"},"richiestaAllocazioneId":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d2","description":"ID della richiesta di allocazione"},"idUtenteFDO":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d3","description":"ID dell'utente FDO che ha accettato"},"timestamp":{"type":"string","format":"date-time","example":"2025-06-06T14:30:00.000Z","description":"Data e ora della conferma"},"utenteFDO":{"type":"object","nullable":true,"description":"Dati dell'utente FDO che ha accettato la richiesta","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d3"},"nome":{"type":"string","example":"Marco"},"cognome":{"type":"string","example":"Bianchi"},"email":{"type":"string","example":"marco.bianchi@fdo.it"},"tipoUtente":{"type":"string","example":"UtenteFDO"}}},"richiestaAllocazione":{"type":"object","nullable":true,"description":"Dati completi della richiesta di allocazione","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d2"},"idSegnalazione":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d4"},"stato":{"type":"string","example":"accettata"},"dataRichiesta":{"type":"string","format":"date-time","example":"2025-06-06T12:00:00.000Z"},"segnalazione":{"type":"object","nullable":true,"description":"Dati della segnalazione associata alla richiesta","properties":{"_id":{"type":"string","example":"64f1a2b3c4d5e6f7a8b9c0d4"},"tipologia":{"type":"string","example":"Furto"},"descrizione":{"type":"string","example":"Furto di bicicletta in centro storico"},"coordinateGps":{"type":"object","properties":{"type":{"type":"string","example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.1219482,46.0664014]}}},"timeStamp":{"type":"string","format":"date-time","example":"2025-06-06T10:30:00.000Z"},"stato":{"type":"string","example":"in_gestione"}}}}},"errore":{"type":"string","nullable":true,"example":null,"description":"Eventuale errore nel caricamento dei dati correlati"}}}},"count":{"type":"integer","example":15,"description":"Numero totale di notifiche di conferma trovate"},"message":{"type":"string","example":"Trovate 15 notifiche di conferma richieste allocazione"}}},"examples":{"successo_con_dati":{"summary":"Risposta con notifiche trovate","value":{"success":true,"data":[{"_id":"64f1a2b3c4d5e6f7a8b9c0d1","richiestaAllocazioneId":"64f1a2b3c4d5e6f7a8b9c0d2","idUtenteFDO":"64f1a2b3c4d5e6f7a8b9c0d3","timestamp":"2025-06-06T14:30:00.000Z","utenteFDO":{"_id":"64f1a2b3c4d5e6f7a8b9c0d3","nome":"Marco","cognome":"Bianchi","email":"marco.bianchi@fdo.it","tipoUtente":"UtenteFDO"},"richiestaAllocazione":{"_id":"64f1a2b3c4d5e6f7a8b9c0d2","idSegnalazione":"64f1a2b3c4d5e6f7a8b9c0d4","stato":"accettata","dataRichiesta":"2025-06-06T12:00:00.000Z","segnalazione":{"_id":"64f1a2b3c4d5e6f7a8b9c0d4","tipologia":"Furto","descrizione":"Furto di bicicletta in centro storico","coordinateGps":{"type":"Point","coordinates":[11.1219482,46.0664014]},"timeStamp":"2025-06-06T10:30:00.000Z","stato":"in_gestione"}},"errore":null}],"count":1,"message":"Trovate 1 notifiche di conferma richieste allocazione"}},"nessuna_notifica":{"summary":"Nessuna notifica trovata","value":{"success":true,"data":[],"count":0,"message":"Nessuna notifica di conferma trovata"}},"dati_parziali":{"summary":"Notifica con dati mancanti","value":{"success":true,"data":[{"_id":"64f1a2b3c4d5e6f7a8b9c0d1","richiestaAllocazioneId":"64f1a2b3c4d5e6f7a8b9c0d2","idUtenteFDO":"64f1a2b3c4d5e6f7a8b9c0d3","timestamp":"2025-06-06T14:30:00.000Z","utenteFDO":null,"richiestaAllocazione":null,"errore":"Utente FDO non trovato"}],"count":1,"message":"Trovate 1 notifiche di conferma richieste allocazione"}}}}}},"401":null,"500":{"description":"Errore interno del server","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Errore interno del server"},"error":{"type":"string","example":"Database connection failed"}}},"examples":{"errore_database":{"summary":"Errore di connessione al database","value":{"success":false,"message":"Errore interno del server","error":"Database connection failed"}},"errore_generico":{"summary":"Errore generico del server","value":{"success":false,"message":"Errore interno del server nel recupero notifiche richieste allocazione","error":"Internal server error"}}}}}}}}},"/api/richieste-allocazione":{"get":{"summary":"Recupera tutte le richieste di allocazione","tags":["Richieste Allocazione"],"description":"Restituisce un array contenente tutte le richieste di allocazione presenti nel database","responses":{"200":{"description":"Lista di richieste di allocazione recuperata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/RichiestaAllocazione"}},"count":{"type":"integer","description":"Numero totale di richieste","example":15},"message":{"type":"string","example":"Richieste allocazione retrieved successfully"}}}}}},"403":{"description":"Accesso negato","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Accesso negato"}}}}}},"500":{"description":"Errore del server","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Server error"}}}}}}}},"post":{"summary":"Crea una nuova richiesta di allocazione","tags":["Richieste Allocazione"],"description":"Crea una nuova richiesta di allocazione nel database","requestBody":{"required":true,"content":{"application/json":{"example":{"idRichiestaAllocazione":"REQ_001","zonaDiOperazione":{"coordinateGps":{"coordinates":[11.12,46.07]},"fasciaOraria":"08:00-12:00","giornoSettimana":"lunedì"}}}}},"responses":{"201":{"description":"Richiesta di allocazione creata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/RichiestaAllocazione"},"message":{"type":"string","example":"Richiesta allocazione creata"}}}}}},"400":{"description":"Dati non validi"},"403":{"description":"Accesso negato"},"500":{"description":"Errore del server"}}}},"/api/richieste-allocazione/{id}":{"get":{"summary":"Recupera una richiesta di allocazione specifica","tags":["Richieste Allocazione"],"description":"Restituisce una richiesta di allocazione in base all'ID fornito","parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della richiesta di allocazione","example":"60d21b4967d0d8992e610c85"}],"responses":{"200":{"description":"Richiesta di allocazione recuperata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/RichiestaAllocazione"},"message":{"type":"string","example":"Richiesta allocazione retrieved successfully"}}}}}},"403":{"description":"Accesso negato"},"404":{"description":"Richiesta di allocazione non trovata"},"500":{"description":"Errore del server"}}},"put":{"summary":"Accetta una richiesta di allocazione","tags":["Richieste Allocazione"],"description":"Imposta lo stato della richiesta di allocazione su \"accettato\"","parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della richiesta di allocazione"}],"requestBody":{"required":false},"responses":{"200":{"description":"Richiesta di allocazione aggiornata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/RichiestaAllocazione"},"message":{"type":"string","example":"Richiesta allocazione aggiornata con successo"}}}}}},"403":{"description":"Accesso negato"},"404":{"description":"Richiesta non trovata"},"500":{"description":"Errore del server"}}},"delete":{"summary":"Elimina una richiesta di allocazione","tags":["Richieste Allocazione"],"description":"Elimina una richiesta di allocazione dal sistema","parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della richiesta di allocazione"}],"responses":{"200":{"description":"Richiesta di allocazione eliminata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/RichiestaAllocazione"},"message":{"type":"string","example":"Richiesta allocazione deleted successfully"}}}}}},"403":{"description":"Accesso negato"},"404":{"description":"Richiesta non trovata"},"500":{"description":"Errore del server"}}}},"/api/segnalazioni":{"get":{"summary":"Recupera tutte le segnalazioni con filtri opzionali","tags":["Segnalazioni"],"description":"Restituisce un array contenente le segnalazioni filtrate in base ai parametri forniti.\n\n**Filtro Date:**\n- Se non vengono forniti parametri di data, vengono restituite le segnalazioni degli ultimi 30 giorni\n- È possibile specificare un range personalizzato usando dataDa e/o dataA\n- Le date vengono automaticamente impostate all'inizio (00:00:00) e fine giornata (23:59:59)\n\n**Filtro Tipologie (Multi-Select):**\n- È possibile filtrare per una o più tipologie contemporaneamente\n- Usa parametri multipli con lo stesso nome: ?tipologia=FURTO&tipologia=SPACCIO\n- Se nessuna tipologia viene specificata, vengono restituite tutte le tipologie\n- Tipologie non valide vengono ignorate con un warning\n\n**Permessi:**\n- Accessibile solo a UtenteFDO e UtenteComunale\n- UtenteCittadino: accesso negato (403)\n","parameters":[{"in":"query","name":"dataDa","required":false,"schema":{"type":"string","format":"date","example":"2024-05-01"},"description":"Data di inizio del range di ricerca (formato YYYY-MM-DD o ISO string).\nSe omesso, viene utilizzata la data di 30 giorni fa come default.\n"},{"in":"query","name":"dataA","required":false,"schema":{"type":"string","format":"date","example":"2024-05-31"},"description":"Data di fine del range di ricerca (formato YYYY-MM-DD o ISO string).\nSe omesso, viene utilizzata la data odierna come default.\n"},{"in":"query","name":"tipologia","required":false,"style":"form","explode":true,"schema":{"type":"array","items":{"type":"string","enum":["RISSA","SPACCIO","FURTO","DEGRADO","DISTURBO","VANDALISMO","ALTRO"]},"example":["FURTO","SPACCIO"]},"description":"Filtra per una o più tipologie di segnalazione (case-insensitive).\n\n**Modalità di utilizzo:**\n- Singola tipologia: `?tipologia=FURTO`\n- Multiple tipologie: `?tipologia=FURTO&tipologia=SPACCIO&tipologia=RISSA`\n\n**Comportamento:**\n- Se omesso: vengono restituite tutte le tipologie\n- Tipologie non valide vengono ignorate automaticamente\n- Se tutte le tipologie sono non valide, viene restituito errore 400\n"},{"in":"query","name":"stato","required":false,"schema":{"type":"string","enum":["aperto","chiuso"],"example":"aperto"},"description":"Filtra per stato della segnalazione (case-insensitive)"}],"responses":{"200":{"description":"Lista di segnalazioni recuperata con successo","content":{"application/json":{"examples":{"default_range":{"summary":"Esempio con range di default (ultimi 30 giorni)","value":{"success":true,"data":[],"count":15,"filtri":{"tipologie":null,"stato":null,"dataDa":"2024-05-07T00:00:00.000Z","dataA":"2024-06-06T23:59:59.999Z","isDefaultRange":true},"message":"15 segnalazioni trovate (ultimi 30 giorni)"}},"single_tipologia":{"summary":"Esempio con singola tipologia","value":{"success":true,"data":[],"count":8,"filtri":{"tipologie":["FURTO"],"stato":null,"dataDa":"2024-05-07T00:00:00.000Z","dataA":"2024-06-06T23:59:59.999Z","isDefaultRange":true},"message":"8 segnalazioni trovate (ultimi 30 giorni)"}},"multiple_tipologie":{"summary":"Esempio con multiple tipologie","value":{"success":true,"data":[],"count":12,"filtri":{"tipologie":["FURTO","SPACCIO","RISSA"],"stato":"aperto","dataDa":"2024-05-01T00:00:00.000Z","dataA":"2024-05-31T23:59:59.999Z","isDefaultRange":false},"message":"12 segnalazioni trovate"}},"custom_filter":{"summary":"Esempio con tutti i filtri personalizzati","value":{"success":true,"data":[],"count":5,"filtri":{"tipologie":["FURTO","VANDALISMO"],"stato":"aperto","dataDa":"2024-05-01T00:00:00.000Z","dataA":"2024-05-31T23:59:59.999Z","isDefaultRange":false},"message":"5 segnalazioni trovate"}}}}}},"400":{"description":"Parametri non validi","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string"}}},"examples":{"all_tipologie_invalid":{"summary":"Tutte le tipologie sono non valide","value":{"success":false,"message":"Tipologie non valide: INVALID1, INVALID2. Valori consentiti: RISSA, SPACCIO, FURTO, DEGRADO, DISTURBO, VANDALISMO, ALTRO"}},"invalid_stato":{"summary":"Stato non valido","value":{"success":false,"message":"Stato non valido. Valori consentiti: aperto, chiuso"}},"invalid_date":{"summary":"Data non valida","value":{"success":false,"message":"DataDa non valida. Formato richiesto: YYYY-MM-DD o ISO string"}}}}}},"403":{"description":"Accesso negato","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Accesso negato"}}}}}},"500":{"description":"Errore del server","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":false},"message":{"type":"string","example":"Errore interno del server"},"error":{"type":"string","example":"Database connection failed"}}}}}}}},"post":{"summary":"Crea una nuova segnalazione","tags":["Segnalazioni"],"description":"Crea una nuova segnalazione nel database. Coordinate di Trento generate automaticamente se non fornite.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["tipologia"],"properties":{"tipologia":{"type":"string","enum":["RISSA","SPACCIO","FURTO","DEGRADO","DISTURBO","VANDALISMO","ALTRO"],"example":"FURTO"},"descrizione":{"type":"string","example":"Ho visto una persona che rubava uno zaino"},"telefonata":{"type":"boolean","example":false},"media":{"type":"string","example":"https://example.com/foto.jpg"},"idUtente":{"type":"string","example":"user456"},"coordinateGps":{"type":"object","properties":{"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}}}}}}},"responses":{"201":{"description":"Segnalazione creata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Segnalazione"}}}}}},"400":{"description":"Dati non validi"},"500":{"description":"Errore del server"}}}},"/api/segnalazioni/nearby/{fdoId}":{"get":{"summary":"Recupera segnalazioni nelle vicinanze di un utente FDO","tags":["Segnalazioni"],"description":"Restituisce tutte le segnalazioni aperte in un raggio specifico dalla posizione corrente dell'utente FDO","parameters":[{"in":"path","name":"fdoId","required":true,"schema":{"type":"string"},"description":"ID MongoDB dell'utente FDO"},{"in":"query","name":"radius","required":false,"schema":{"type":"number","default":5000},"description":"Raggio di ricerca in metri"}],"responses":{"200":{"description":"Segnalazioni nearby recuperate con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/Segnalazione"}},"count":{"type":"integer","example":3}}}}}}}}},"/api/segnalazioni/mySegnalazioni":{"get":{"summary":"Recupera le segnalazioni dell'utente corrente","tags":["Segnalazioni"],"description":"Restituisce tutte le segnalazioni effettuate dall'utente autenticato","responses":{"200":{"description":"Segnalazioni recuperate con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/Segnalazione"}}}}}}}}}},"/api/segnalazioni/{id}":{"get":{"summary":"Recupera una segnalazione specifica","tags":["Segnalazioni"],"description":"Restituisce una segnalazione in base all'ID fornito","parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della segnalazione"}],"responses":{"200":{"description":"Segnalazione recuperata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Segnalazione"}}}}}},"404":{"description":"Segnalazione non trovata"},"500":{"description":"Errore del server"}}},"put":{"summary":"Aggiorna una segnalazione esistente","tags":["Segnalazioni"],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della segnalazione"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"tipologia":{"type":"string","enum":["RISSA","SPACCIO","FURTO","DEGRADO","DISTURBO","VANDALISMO","ALTRO"]},"descrizione":{"type":"string"},"stato":{"type":"string","enum":["aperto","chiuso"]},"telefonata":{"type":"boolean"},"media":{"type":"string"}}}}}},"responses":{"200":{"description":"Segnalazione aggiornata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Segnalazione"}}}}}},"404":{"description":"Segnalazione non trovata"},"500":{"description":"Errore del server"}}},"delete":{"summary":"Elimina una segnalazione","tags":["Segnalazioni"],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"ID MongoDB della segnalazione"}],"responses":{"200":{"description":"Segnalazione eliminata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Segnalazione eliminata con successo"}}}}}},"404":{"description":"Segnalazione non trovata"},"500":{"description":"Errore del server"}}}},"/api/utenti":{"get":{"summary":"Recupera tutti gli utenti","tags":["Utenti"],"description":"Restituisce una lista di tutti gli utenti registrati nel sistema","responses":{"200":{"description":"Lista di utenti recuperata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/Utente"}},"count":{"type":"integer","description":"Numero totale di utenti","example":10},"message":{"type":"string","example":"Utenti recuperati con successo"}}}}}},"500":{"description":"Errore del server"}}}},"/api/utenti/{tipo}":{"get":{"summary":"Recupera utenti per tipo","tags":["Utenti"],"description":"Restituisce tutti gli utenti di un tipo specifico attivi (standard, comunale, fdo)","parameters":[{"in":"path","name":"tipo","required":true,"schema":{"type":"string","enum":["standard","comunale","fdo"]},"description":"Tipo di utente da recuperare"}],"responses":{"200":{"description":"Lista di utenti del tipo specificato recuperata con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/Utente"}},"count":{"type":"integer","example":5},"message":{"type":"string","example":"Utenti di tipo standard recuperati con successo"}}}}}},"400":{"description":"Tipo di utente non valido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore del server"}}}},"/api/utenti/id/{id}":{"get":{"summary":"Recupera un utente specifico tramite ID","tags":["Utenti"],"description":"Restituisce i dettagli di un utente specifico identificato dall'ID","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"ID MongoDB dell'utente"}],"responses":{"200":{"description":"Dettagli dell'utente recuperati con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Utente"},"message":{"type":"string","example":"Utente recuperato con successo"}}}}}},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore del server"}}}},"/api/utenti/register/{tipo}":{"post":{"summary":"Registra un nuovo utente","tags":["Utenti"],"description":"Crea un nuovo utente del tipo specificato (standard, comunale, fdo)","parameters":[{"in":"path","name":"tipo","required":true,"schema":{"type":"string","enum":["standard","comunale","fdo"]},"description":"Tipo di utente da registrare"}],"requestBody":{"required":true,"content":{"application/json":{"schema":null}}},"responses":{"201":{"description":"Utente registrato con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Utente"},"message":{"type":"string","example":"Utente standard registrato con successo"}}}}}},"400":{"description":"Dati non validi o utente già esistente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore del server"}}}},"/api/utenti/{id}":{"delete":{"summary":"Elimina un utente","tags":["Utenti"],"description":"Disattiva un utente specifico dal sistema","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"ID MongoDB dell'utente da eliminare"}],"responses":{"200":{"description":"Utente eliminato con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Utente eliminato con successo"}}}}}},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore del server"}}},"put":{"summary":"Aggiorna i dati di un utente esistente","tags":["Utenti"],"description":"Permette di aggiornare la password per tutti i tipi di utente. Per gli utenti FDO permette anche di aggiornare zoneDiOperazione e coordinateGps.","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"ID MongoDB dell'utente da aggiornare"}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"password":{"type":"string","format":"password","minLength":7,"description":"Nuova password (min 7 caratteri)","example":"nuovaPassword123"},"zoneDiOperazione":{"type":"array","description":"Zone di operazione (solo per utenti FDO)","items":{"type":"object","required":["coordinateGps","fasceOrarie"],"properties":{"coordinateGps":{"type":"object","properties":{"type":{"type":"string","enum":["Polygon"],"example":"Polygon"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}},"fasceOrarie":{"type":"array","items":{"type":"number","minimum":0,"maximum":23},"example":[8,9,10,11],"description":"Ore del giorno (0-23)"},"giorniSettimana":{"type":"array","items":{"type":"string","enum":["Lunedi","Martedi","Mercoledi","Giovedi","Venerdi","Sabato","Domenica"]},"example":["Lunedi","Martedi","Mercoledi"]}}}},"coordinateGps":{"type":"object","description":"Posizione attuale dell'agente (solo per utenti FDO)","properties":{"type":{"type":"string","enum":["Point"],"example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}}}}}}},"responses":{"200":{"description":"Utente aggiornato con successo","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Utente"},"message":{"type":"string","example":"Utente aggiornato con successo"}}}}}},"400":{"description":"Dati non validi, ID non valido o nessun campo da aggiornare","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error","examples":{"invalidId":{"value":{"success":false,"message":"ID utente non valido"}},"shortPassword":{"value":{"success":false,"message":"La password deve essere di almeno 7 caratteri"}},"noData":{"value":{"success":false,"message":"Nessun campo valido fornito per l'aggiornamento"}}}}}}},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore del server"}}}}},"components":{"schemas":{"RichiestaAllocazione":{"type":"object","required":["idRichiestaAllocazione","zonaDiOperazione"],"properties":{"_id":{"type":"string","description":"ID automatico generato da MongoDB","example":"60d21b4967d0d8992e610c85"},"idRichiestaAllocazione":{"type":"string","description":"ID univoco della richiesta di allocazione","example":"REQ_001"},"zonaDiOperazione":{"type":"object","required":["coordinateGps","fasciaOraria","giornoSettimana"],"properties":{"coordinateGps":{"type":"object","properties":{"type":{"type":"string","enum":["Point"],"description":"Tipo GeoJSON","example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"description":"Coordinate [longitudine, latitudine]","example":[11.12,46.07]}}},"fasciaOraria":{"type":"string","description":"Fascia oraria dell'operazione","example":"08:00-12:00"},"giornoSettimana":{"type":"string","description":"Giorno della settimana","example":"lunedì"}}},"stato":{"type":"string","enum":["pendente","assegnata","completata","annullata"],"description":"Stato attuale della richiesta","default":"pendente","example":"pendente"},"timeStampCreazione":{"type":"string","format":"date-time","description":"Data e ora di creazione della richiesta","example":"2023-05-18T14:30:00Z"}}},"RichiestaAllocazioneInput":{"type":"object","required":["idRichiestaAllocazione","zonaDiOperazione"],"properties":{"idRichiestaAllocazione":{"type":"string","description":"ID univoco della richiesta di allocazione","example":"REQ_001"},"zonaDiOperazione":{"type":"object","required":["coordinateGps","fasciaOraria","giornoSettimana"],"properties":{"coordinateGps":{"type":"object","properties":{"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}},"fasciaOraria":{"type":"string","example":"08:00-12:00"},"giornoSettimana":{"type":"string","example":"lunedì"}}}}},"Segnalazione":{"type":"object","required":["tipologia"],"properties":{"_id":{"type":"string","description":"ID automatico generato da MongoDB","example":"60d21b4967d0d8992e610c85"},"timeStamp":{"type":"string","format":"date-time","description":"Data e ora della segnalazione","example":"2023-05-18T14:30:00Z"},"coordinateGps":{"type":"object","properties":{"type":{"type":"string","enum":["Point"],"description":"Tipo GeoJSON","example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"description":"Coordinate [longitudine, latitudine]","example":[11.12,46.07]}}},"tipologia":{"type":"string","enum":["RISSA","SPACCIO","FURTO","DEGRADO","DISTURBO","VANDALISMO","ALTRO"],"description":"Tipo di segnalazione","example":"FURTO"},"stato":{"type":"string","enum":["aperto","chiuso"],"description":"Stato attuale della segnalazione","example":"aperto"},"telefonata":{"type":"boolean","description":"Flag che indica se è stata effettuata una telefonata","default":false,"example":false},"media":{"type":"string","description":"URL del media allegato (immagine/video)","example":"https://example.com/media/image123.jpg"},"descrizione":{"type":"string","description":"Descrizione dettagliata della segnalazione","example":"Ho notato un individuo sospetto che cercava di forzare la portiera di un'auto"},"idUtente":{"type":"string","description":"Identificativo dell'utente che ha effettuato la segnalazione","example":"user123"}}},"UtenteRegistrato":{"type":"object","required":["nome","cognome","telefono","password"],"properties":{"nome":{"type":"string","example":"Mario"},"cognome":{"type":"string","example":"Rossi"},"telefono":{"type":"string","example":"3401234567"},"password":{"type":"string","format":"password","minLength":7,"example":"password123"}}},"UtenteComunale":{"allOf":[{"$ref":"#/components/schemas/UtenteRegistratoInput"},{"type":"object","properties":{"nome":{"type":"string","example":"Mario"},"cognome":{"type":"string","example":"Rossi"},"telefono":{"type":"string","example":"3401234567"},"password":{"type":"string","format":"password","minLength":7,"example":"password123"}}}]},"UtenteFDO":{"allOf":[{"$ref":"#/components/schemas/UtenteRegistratoInput"},{"type":"object","required":["TipoFDO"],"properties":{"nome":{"type":"string","example":"Mario"},"cognome":{"type":"string","example":"Rossi"},"telefono":{"type":"string","example":"3401234567"},"password":{"type":"string","format":"password","minLength":7,"example":"password123"},"TipoFDO":{"type":"string","enum":["POLIZIA","CARABINIERI","GUARDIA DI FINANZA"],"example":"POLIZIA"},"disponibilità":{"type":"boolean","example":true},"zoneDiOperazione":{"type":"array","items":{"type":"object","properties":{"coordinateGps":{"type":"object","properties":{"type":{"type":"string","example":"Polygon"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}},"fasceOrarie":{"type":"array","items":{"type":"number"},"example":[8,9,10,11]},"giorniSettimana":{"type":"array","items":{"type":"string","enum":["Lunedi","Martedi","Mercoledi","Giovedi","Venerdi","Sabato","Domenica"]},"example":["Lunedi","Martedi","Mercoledi"]}}}},"coordinateGps":{"type":"object","properties":{"type":{"type":"string","example":"Point"},"coordinates":{"type":"array","items":{"type":"number"},"example":[11.12,46.07]}}}}}]}}},"tags":[{"name":"Richieste Allocazione","description":"API per la gestione delle richieste di allocazione delle forze dell'ordine"},{"name":"Segnalazioni","description":"API per la gestione delle segnalazioni"}]},
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout"
      });
      // End Swagger UI call region
      window.ui = ui;
    }
  </script>
</body>
</html>
